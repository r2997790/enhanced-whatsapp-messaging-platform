            document.getElementById('bulk-phones').value = phoneList.join('\\n');
            
            if (phoneList.length > 0) {
                previewRecipients();
            } else {
                document.getElementById('recipients-preview').style.display = 'none';
                showStatus('âœ… Recipient removed', 'success');
            }
        }

        // Clear bulk form function
        function clearBulkForm() {
            if (bulkSending) {
                if (!confirm('Bulk sending is in progress. Are you sure you want to clear the form?')) {
                    return;
                }
            }
            
            document.getElementById('bulk-message-form').reset();
            document.getElementById('recipients-preview').style.display = 'none';
            document.getElementById('bulk-progress').style.display = 'none';
            document.getElementById('delay').value = 5;
            
            // Reset bulk sending state
            bulkSending = false;
            bulkStats = { total: 0, sent: 0, failed: 0, current: 0 };
            
            showStatus('âœ… Form cleared', 'success');
        }

        // Start bulk sending with progress tracking
        function startBulkSending(phoneList, message, delay) {
            bulkSending = true;
            bulkStats = {
                total: phoneList.length,
                sent: 0,
                failed: 0,
                current: 0
            };
            
            // Show progress section
            const progressDiv = document.getElementById('bulk-progress');
            progressDiv.style.display = 'block';
            
            // Update initial stats
            updateBulkProgress();
            
            showStatus(`ðŸ“¤ Starting bulk send to ${phoneList.length} recipients...`, 'success');
            
            // Send bulk message request to server
            socket.emit('send_bulk_messages', {
                phoneNumbers: phoneList,
                message: message,
                delay: delay * 1000 // Convert to milliseconds
            });
        }

        // Update bulk progress display
        function updateBulkProgress() {
            const progressFill = document.getElementById('progress-fill');
            const sentCount = document.getElementById('sent-count');
            const failedCount = document.getElementById('failed-count');
            const remainingCount = document.getElementById('remaining-count');
            
            const percentage = bulkStats.total > 0 ? Math.round(((bulkStats.sent + bulkStats.failed) / bulkStats.total) * 100) : 0;
            const remaining = bulkStats.total - bulkStats.sent - bulkStats.failed;
            
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
            
            sentCount.textContent = bulkStats.sent;
            failedCount.textContent = bulkStats.failed;
            remainingCount.textContent = remaining;
        }

        // Complete bulk sending
        function completeBulkSending() {
            bulkSending = false;
            
            document.getElementById('current-number').textContent = 
                `âœ… Completed! Sent: ${bulkStats.sent}, Failed: ${bulkStats.failed}`;
            
            const successRate = bulkStats.total > 0 ? Math.round((bulkStats.sent / bulkStats.total) * 100) : 0;
            
            showStatus(
                `ðŸŽ‰ Bulk sending completed! ${bulkStats.sent}/${bulkStats.total} messages sent successfully (${successRate}% success rate)`,
                bulkStats.failed === 0 ? 'success' : 'error'
            );
            
            // Clear form after successful completion
            setTimeout(() => {
                if (bulkStats.failed === 0) {
                    clearBulkForm();
                }
            }, 5000);
        }

        // Message logging
        function logMessage(phone, message, status, timestamp, error = null) {
            const log = {
                id: Date.now(),
                phone: phone,
                message: message,
                status: status,
                timestamp: timestamp || new Date().toISOString(),
                error: error
            };
            
            messageLogs.unshift(log);
            
            if (messageLogs.length > 100) {
                messageLogs = messageLogs.slice(0, 100);
            }
            
            localStorage.setItem('messageLogs', JSON.stringify(messageLogs));
            updateStats();
            refreshLogs();
        }

        // Load message logs
        function loadMessageLogs() {
            const saved = localStorage.getItem('messageLogs');
            if (saved) {
                messageLogs = JSON.parse(saved);
            }
        }

        // Update statistics
        function updateStats() {
            const totalSent = messageLogs.length;
            const totalSuccess = messageLogs.filter(log => log.status === 'sent').length;
            const totalFailed = messageLogs.filter(log => log.status === 'failed').length;
            
            document.getElementById('total-sent').textContent = totalSent;
            document.getElementById('total-success').textContent = totalSuccess;
            document.getElementById('total-failed').textContent = totalFailed;
        }

        // Refresh logs display
        function refreshLogs() {
            const logsContainer = document.getElementById('logs-container');
            
            if (messageLogs.length === 0) {
                logsContainer.innerHTML = `
                    <div style="text-align: center; color: #666; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ðŸ“­</div>
                        <p>No messages sent yet</p>
                        <p style="font-size: 14px; margin-top: 10px;">Start sending messages to see logs here</p>
                    </div>
                `;
                return;
            }
            
            logsContainer.innerHTML = messageLogs.map(log => {
                const timestamp = new Date(log.timestamp).toLocaleString();
                const phoneDisplay = log.phone.replace('@c.us', '');
                
                return `
                    <div style="background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; margin-bottom: 10px; border-left: 4px solid #25D366;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>ðŸ“± ${phoneDisplay}</strong>
                            <div>
                                <span style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; background: ${log.status === 'sent' ? '#d4edda' : '#f8d7da'}; color: ${log.status === 'sent' ? '#155724' : '#721c24'};">${log.status.toUpperCase()}</span>
                                <span style="color: #6c757d; font-size: 12px; margin-left: 10px;">${timestamp}</span>
                            </div>
                        </div>
                        <div style="color: #666; margin-bottom: 10px;">
                            ${log.message.substring(0, 100)}${log.message.length > 100 ? '...' : ''}
                        </div>
                        ${log.error ? `<div style="color: #dc3545; font-size: 12px;">Error: ${log.error}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
    </script>
</body>
</html>